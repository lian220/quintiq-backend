# ìŠ¤ì¼€ì¤„ëŸ¬ ì•„í‚¤í…ì²˜

**ëª©ì **: QuantIQ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œìŠ¤í…œì˜ êµ¬ì¡°ì™€ ì‘ë™ ë°©ì‹ ì„¤ëª…
**ëŒ€ìƒ**: ê°œë°œì, ì‹œìŠ¤í…œ ê´€ë¦¬ì
**ì‘ì„±ì¼**: 2026-01-31
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-02-01 (v2.0 - Vertex AI í†µí•© ë° ìŠ¤ì¼€ì¤„ ìµœì í™”)

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì•„í‚¤í…ì²˜ êµ¬ì¡°](#ì•„í‚¤í…ì²˜-êµ¬ì¡°)
3. [Quartz ìŠ¤ì¼€ì¤„ëŸ¬](#quartz-ìŠ¤ì¼€ì¤„ëŸ¬)
4. [Job ì‹¤í–‰ íë¦„](#job-ì‹¤í–‰-íë¦„)
5. [ë“±ë¡ëœ Job](#ë“±ë¡ëœ-job)
6. [ë°ì´í„° ì €ì¥ì†Œ](#ë°ì´í„°-ì €ì¥ì†Œ)
7. [ì´ë²¤íŠ¸ ê¸°ë°˜ í†µí•©](#ì´ë²¤íŠ¸-ê¸°ë°˜-í†µí•©)

---

## ê°œìš”

QuantIQ ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” **Quartz Scheduler**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, **Hexagonal Architecture** íŒ¨í„´ì„ ì ìš©í•˜ì—¬ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•

- **ì •ê¸° ì‘ì—… ìë™í™”**: ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸, ë³‘ë ¬ ë¶„ì„ ë“±ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰
- **ìœ ì—°í•œ ìŠ¤ì¼€ì¤„ ê´€ë¦¬**: Cron í‘œí˜„ì‹ì„ ì‚¬ìš©í•œ ì •ë°€í•œ ì‹œê°„ ì œì–´
- **ì˜ì†ì„± ì§€ì›**: PostgreSQLì— ìŠ¤ì¼€ì¤„ ìƒíƒœ ì €ì¥ (ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ ì‹œì—ë„ ìœ ì§€)
- **í´ëŸ¬ìŠ¤í„°ë§ ì§€ì›**: ë¶„ì‚° í™˜ê²½ì—ì„œ ì•ˆì „í•œ Job ì‹¤í–‰
- **REST API**: HTTP APIë¥¼ í†µí•œ ìŠ¤ì¼€ì¤„ëŸ¬ ì œì–´ (pause/resume/start/stop)

### ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ì„± ìš”ì†Œ | ê¸°ìˆ  |
|----------|------|
| ìŠ¤ì¼€ì¤„ëŸ¬ | Quartz Scheduler 2.3+ |
| ì–¸ì–´ | Kotlin |
| í”„ë ˆì„ì›Œí¬ | Spring Boot 3.x |
| ì•„í‚¤í…ì²˜ | Hexagonal Architecture |
| ì €ì¥ì†Œ | PostgreSQL |
| íƒ€ì„ì¡´ | Asia/Seoul (KST) |

---

## ì•„í‚¤í…ì²˜ êµ¬ì¡°

### Hexagonal Architecture ì ìš©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Input Adapters                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SchedulerRestController    EconomicDataUpdateJobAdapter    â”‚
â”‚  (REST API)                 (Quartz Job)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                     â”‚
                 â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Domain Layer (Port)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Input Port:  SchedulerUseCase                              â”‚
â”‚  Output Port: SchedulerRepository                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Application Layer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SchedulerManagementService (UseCase êµ¬í˜„)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Output Adapters                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  QuartzSchedulerAdapter (Repository êµ¬í˜„)                   â”‚
â”‚  â†“                                                           â”‚
â”‚  Quartz Scheduler â†’ PostgreSQL                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸

#### Input Adapters
- **SchedulerRestController**: HTTP ìš”ì²­ì„ ë°›ì•„ UseCaseë¡œ ì „ë‹¬
  - ê²½ë¡œ: `/api/scheduler/*`
  - ê¸°ëŠ¥: ìƒíƒœ ì¡°íšŒ, ìŠ¤ì¼€ì¤„ ê´€ë¦¬, ì‹œì‘/ì¤‘ì§€
- **EconomicDataUpdateJobAdapter**: Quartz íŠ¸ë¦¬ê±°ë¥¼ ë°›ì•„ ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤í–‰
- **ParallelAnalysisJob**: Quartz íŠ¸ë¦¬ê±°ë¥¼ ë°›ì•„ ë³‘ë ¬ ë¶„ì„ ì‹¤í–‰

#### Domain Layer (Port)
- **SchedulerUseCase** (Input Port): ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë¦¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¸í„°í˜ì´ìŠ¤
- **SchedulerRepository** (Output Port): ìŠ¤ì¼€ì¤„ëŸ¬ ì €ì¥ì†Œ ì¸í„°í˜ì´ìŠ¤

#### Application Layer
- **SchedulerManagementService**: UseCase êµ¬í˜„ì²´, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬

#### Output Adapters
- **QuartzSchedulerAdapter**: SchedulerRepository êµ¬í˜„, Quartzì™€ ì—°ë™

---

## Quartz ìŠ¤ì¼€ì¤„ëŸ¬

### í•µì‹¬ ê°œë…

| ê°œë… | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **Job** | ì‹¤í–‰í•  ì‘ì—… | `EconomicDataUpdateJobAdapter` |
| **JobDetail** | Jobì˜ ë©”íƒ€ë°ì´í„° | Job ì´ë¦„, ì„¤ëª…, í´ë˜ìŠ¤ |
| **Trigger** | ì‹¤í–‰ ì‹œì  ì •ì˜ | Cron í‘œí˜„ì‹ ê¸°ë°˜ íŠ¸ë¦¬ê±° |
| **Scheduler** | Jobê³¼ Trigger ê´€ë¦¬ | Quartz Scheduler ì¸ìŠ¤í„´ìŠ¤ |

### Cron í‘œí˜„ì‹ êµ¬ì¡°

```
ì´ˆ(0-59) ë¶„(0-59) ì‹œ(0-23) ì¼(1-31) ì›”(1-12) ìš”ì¼(0-7) [ë…„ë„]
```

**ì˜ˆì‹œ:**
```kotlin
"0 5 6 * * ?"      // ë§¤ì¼ 06:05:00 ì‹¤í–‰
"0 5 23 * * ?"     // ë§¤ì¼ 23:05:00 ì‹¤í–‰
"0 0 12 * * MON"   // ë§¤ì£¼ ì›”ìš”ì¼ 12:00 ì‹¤í–‰
```

### QuartzConfig.kt êµ¬ì¡°

```kotlin
@Configuration
class QuartzConfig {

    // 1. JobDetail ìƒì„± (Job ë©”íƒ€ë°ì´í„°)
    @Bean
    fun economicDataUpdateJobDetail(): JobDetail {
        return JobBuilder.newJob(EconomicDataUpdateJobAdapter::class.java)
            .withIdentity("economicDataUpdateJob")
            .storeDurably()  // íŠ¸ë¦¬ê±° ì—†ì–´ë„ ìœ ì§€
            .build()
    }

    // 2. Trigger ìƒì„± (ì‹¤í–‰ ì‹œì )
    @Bean
    fun economicDataUpdateTrigger(): Trigger {
        return TriggerBuilder.newTrigger()
            .forJob(economicDataUpdateJobDetail())
            .withIdentity("economicDataUpdateTrigger")
            .withSchedule(
                CronScheduleBuilder.cronSchedule("0 5 6 * * ?")
                    .inTimeZone(TimeZone.getTimeZone("Asia/Seoul"))
            )
            .build()
    }
}
```

---

## Job ì‹¤í–‰ íë¦„

### 1. ìŠ¤ì¼€ì¤„ ê¸°ë°˜ ì‹¤í–‰ (Cron)

```
ì‹œê°„ ë„ë‹¬ (ì˜ˆ: 06:05)
    â†“
Quartz Scheduler íŠ¸ë¦¬ê±° ë°œë™
    â†“
Job Adapter ì‹¤í–‰ (ì˜ˆ: EconomicDataUpdateJobAdapter)
    â†“
UseCase í˜¸ì¶œ (ì˜ˆ: economicDataUseCase.triggerEconomicDataUpdate())
    â†“
ì´ë²¤íŠ¸ ë°œí–‰ (Kafka: quantiq.economic.data.request)
    â†“
Data Engine ì²˜ë¦¬
    â†“
ì™„ë£Œ ì´ë²¤íŠ¸ ìˆ˜ì‹  (Kafka: quantiq.economic.data.completed)
    â†“
ë¡œê·¸ ê¸°ë¡ ë° ì™„ë£Œ
```

### 2. REST APIë¥¼ í†µí•œ ìˆ˜ë™ ì‹¤í–‰

```
HTTP Request (POST /api/scheduler/start)
    â†“
SchedulerRestController
    â†“
SchedulerManagementService (UseCase)
    â†“
QuartzSchedulerAdapter (Repository)
    â†“
Quartz Scheduler ì‹œì‘
    â†“
HTTP Response (success: true)
```

### 3. Job ì‹¤í–‰ ë¼ì´í”„ì‚¬ì´í´

```kotlin
// Job ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
class EconomicDataUpdateJobAdapter : Job {

    override fun execute(context: JobExecutionContext?) {
        try {
            logger.info("ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘")

            // 1. UseCase í˜¸ì¶œ
            economicDataUseCase.triggerEconomicDataUpdate()
                .thenAccept { result ->
                    logger.info("âœ… ì—…ë°ì´íŠ¸ ì™„ë£Œ: $result")
                }
                .exceptionally { e ->
                    logger.error("âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨", e)
                    null
                }
                .get()  // ë¹„ë™ê¸° ì™„ë£Œ ëŒ€ê¸°

            logger.info("ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì¢…ë£Œ")
        } catch (e: Exception) {
            logger.error("Job ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜", e)
            throw JobExecutionException(e)  // Quartzì— ì‹¤íŒ¨ ì•Œë¦¼
        }
    }
}
```

---

## ë“±ë¡ëœ Job

### 1. ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ + Vertex AI ì˜ˆì¸¡ (EconomicDataUpdate2JobAdapter)

| ì†ì„± | ê°’ |
|------|-----|
| **Job ì´ë¦„** | `economicDataUpdate2Job` |
| **Trigger ì´ë¦„** | `economicDataUpdate2Trigger` |
| **ì‹¤í–‰ ì‹œê°„** | ë§¤ì¼ 22:00 (KST) |
| **Cron í‘œí˜„ì‹** | `0 0 22 * * ?` |
| **ì—­í• ** | ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ + Vertex AI ì˜ˆì¸¡ ì‹¤í–‰ |
| **ì´ë²¤íŠ¸ ë°œí–‰** | `quantiq.economic.data.request` |
| **êµ¬í˜„ ìƒíƒœ** | âœ… êµ¬í˜„ ì™„ë£Œ |

**ì‹¤í–‰ íƒ€ì´ë° ê·¼ê±°:**
- **CPI/NFP ë°œí‘œ**: 21:30 KST (08:30 ET) - ì£¼ìš” ê²½ì œ ì§€í‘œ
- **ISM PMI ë°œí‘œ**: 23:00 KST (10:00 ET) - ì œì¡°ì—… ì§€í‘œ
- **22:00 ì‹¤í–‰**: CPI/NFP ë°œí‘œ ì§í›„, ISM PMI ë°œí‘œ ì§ì „
- **Vertex AI Fine-tuning**: 3-5ë¶„ ì†Œìš” (ê¸°ì¡´ 25-30ë¶„ ëŒ€ë¹„ 83% ë‹¨ì¶•)

**ì‹¤í–‰ íë¦„:**
```
22:00 â†’ EconomicDataUpdate2JobAdapter
      â†’ economicDataUseCase.triggerEconomicDataUpdate()
      â†’ Kafka ì´ë²¤íŠ¸ ë°œí–‰ (ê²½ì œ ë°ì´í„° ìˆ˜ì§‘)
      â†’ Data Engine ì²˜ë¦¬
      â†’ runVertexAIPrediction()
      â†’ Python ìŠ¤í¬ë¦½íŠ¸ (run_predict_vertex_ai.py)
      â†’ Google Vertex AI CustomJob ìƒì„±
      â†’ GPU ê¸°ë°˜ ëª¨ë¸ Fine-tuning (5 epochs)
      â†’ GCSì— ëª¨ë¸/Scaler ì €ì¥
      â†’ ì˜ˆì¸¡ ê²°ê³¼ MongoDB ì €ì¥
```

**Vertex AI í†µí•©:**
- **í”Œë«í¼**: Google Cloud Vertex AI Custom Training Jobs
- **ëª¨ë¸**: Transformer (2-layer, Multi-head Attention)
- **GPU**: NVIDIA Tesla T4 (ê¸°ë³¸), L4 (DWS ì§€ì›)
- **ì €ì¥ì†Œ**: GCS (models/transformer_stock_model.h5)
- **Fine-tuning ëª¨ë“œ**: ê¸°ì¡´ ëª¨ë¸ ë¡œë“œ â†’ 5 epochs í•™ìŠµ (vs ì „ì²´ í•™ìŠµ 50 epochs)
- **ë°ì´í„°**: ìµœê·¼ 24ê°œì›” ë°ì´í„°ë§Œ ë¡œë“œ (ë©”ëª¨ë¦¬ ìµœì í™”)
- **ì˜ˆìƒ ë¹„ìš©**: ~$0.03/day (~$1/month)

### 2. ë³‘ë ¬ ë¶„ì„ (ParallelAnalysisJob) - ê²€ì¦ìš©

| ì†ì„± | ê°’ |
|------|-----|
| **Job ì´ë¦„** | `parallelAnalysisJob` |
| **Trigger ì´ë¦„** | `parallelAnalysisTrigger` |
| **ì‹¤í–‰ ì‹œê°„** | ë§¤ì¼ 23:05 (KST) |
| **Cron í‘œí˜„ì‹** | `0 5 23 * * ?` |
| **ì—­í• ** | Vertex AI ì˜ˆì¸¡ ê²°ê³¼ ê²€ì¦ (ê¸°ìˆ ì  ì§€í‘œ + ê°ì • ë¶„ì„) |
| **êµ¬í˜„ ìƒíƒœ** | âš ï¸ ìŠ¤ì¼ˆë ˆí†¤ë§Œ ì¡´ì¬ (TODO) |

**ì‹¤í–‰ íƒ€ì´ë° ê·¼ê±°:**
- **ISM PMI ë°œí‘œ í›„**: 23:00 ISM PMI ë°œí‘œ ì§í›„ ì‹¤í–‰
- **ì˜ˆì¸¡ ê²€ì¦**: 22:00ì˜ Vertex AI ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ê¸°ìˆ ì  ì§€í‘œë¡œ ê²€ì¦
- **ë§¤ìˆ˜ ì¤€ë¹„**: 00:30 ìë™ ë§¤ìˆ˜ ì „ ìµœì¢… ê²€ì¦ ë‹¨ê³„

**í˜„ì¬ êµ¬í˜„:**
```kotlin
override fun execute(context: JobExecutionContext?) {
    logger.info("ë³‘ë ¬ ë¶„ì„ ì‹œì‘ (23:05)")

    // TODO: ë³‘ë ¬ ë¶„ì„ ë¡œì§ êµ¬í˜„
    // - ê¸°ìˆ ì  ì§€í‘œ ë¶„ì„
    // - ê°ì • ë¶„ì„

    logger.info("ë³‘ë ¬ ë¶„ì„ ì™„ë£Œ")
}
```

**ì˜ˆì •ëœ êµ¬í˜„:**
- Vertex AI ì˜ˆì¸¡ ê²°ê³¼ ì¡°íšŒ
- ê¸°ìˆ ì  ì§€í‘œ ë¶„ì„ ì„œë¹„ìŠ¤ í˜¸ì¶œ (ê²€ì¦ìš©)
- ê°ì • ë¶„ì„ ì„œë¹„ìŠ¤ í˜¸ì¶œ (ê²€ì¦ìš©)
- Kafka ì´ë²¤íŠ¸ ë°œí–‰
- ê²€ì¦ ê²°ê³¼ ì €ì¥ ë° ë§¤ìˆ˜ ì‹ í˜¸ ìƒì„±

### ì „ì²´ Job ëª©ë¡

| # | Job ì´ë¦„ | ì‹¤í–‰ ì‹œê°„ | ì—­í•  | ìƒíƒœ |
|---|----------|----------|------|------|
| 1 | economicDataUpdate2Job | 22:00 (ë§¤ì¼) | ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ + Vertex AI ì˜ˆì¸¡ | âœ… ì™„ë£Œ |
| 2 | parallelAnalysisJob | 23:05 (ë§¤ì¼) | ì˜ˆì¸¡ ê²€ì¦ (ê¸°ìˆ ì  ì§€í‘œ + ê°ì • ë¶„ì„) | âš ï¸ TODO |
| 3 | autoBuyJob | 00:30 (ë§¤ì¼) | ìë™ ë§¤ìˆ˜ ì‹¤í–‰ (ì¥ ê°œì¥ 1ì‹œê°„ í›„) | âœ… ì™„ë£Œ |
| 4 | combinedAnalysisJob | 01:30 (ë§¤ì¼) | ë§¤ìˆ˜ í›„ ê²€ì¦ (ê¸°ìˆ  70% + ê°ì • 30%) | âœ… ì™„ë£Œ |
| 5 | sentimentAnalysisJob | 02:30 (ë§¤ì¼) | ë‰´ìŠ¤ ê°ì • ë¶„ì„ (ë§¤ìˆ˜ ê²°ì • ì¬ê²€ì¦) | âš ï¸ TODO |
| 6 | cleanupOrdersJob | 06:30 (ë§¤ì¼) | ë¯¸ì²´ê²° ì£¼ë¬¸ ì •ë¦¬ | âœ… ì™„ë£Œ |
| 7 | portfolioProfitReportJob | 07:00 (ë§¤ì¼) | í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ìµë¥  ë³´ê³  | âœ… ì™„ë£Œ |
| 8 | autoSellJob | **ë§¤ 1ë¶„** | ìë™ ë§¤ë„ ì²´í¬ (ë¯¸êµ­ ì‹œì¥ ì‹œê°„ë§Œ) | âœ… ì™„ë£Œ |

**ìŠ¤ì¼€ì¤„ ìµœì í™” ê·¼ê±°:**
- **22:00**: CPI/NFP(21:30) ì§í›„, ISM PMI(23:00) ì§ì „ - ì£¼ìš” ì§€í‘œ ë°œí‘œ ì‚¬ì´
- **23:05**: ISM PMI(23:00) ì§í›„ - ëª¨ë“  ê²½ì œ ì§€í‘œ ìˆ˜ì§‘ ì™„ë£Œ í›„ ê²€ì¦
- **00:30**: ë¯¸êµ­ ì¥ ê°œì¥(23:30) 1ì‹œê°„ í›„ - ì´ˆê¸° ë³€ë™ì„± ì•ˆì •í™” í›„ ë§¤ìˆ˜
  - í†µê³„ì  ê·¼ê±°: ì²« 30ë¶„ê°„ ì¼ì¼ ìµœê³ ê°€ì˜ 24% ë°œìƒ, 1ì‹œê°„ í›„ ì•ˆì •í™”
- **01:30**: ë§¤ìˆ˜ 1ì‹œê°„ í›„ - ê¸°ìˆ ì  ë¶„ì„ìœ¼ë¡œ ë§¤ìˆ˜ ê²°ì • ê²€ì¦
- **02:30**: ë§¤ìˆ˜ 2ì‹œê°„ í›„ - ë‰´ìŠ¤ ê°ì • ë¶„ì„ìœ¼ë¡œ ìµœì¢… ê²€ì¦

#### 3. ìë™ ë§¤ìˆ˜ (AutoBuyJobAdapter)

| ì†ì„± | ê°’ |
|------|-----|
| **Job ì´ë¦„** | `autoBuyJob` |
| **Trigger ì´ë¦„** | `autoBuyTrigger` |
| **ì‹¤í–‰ ì‹œê°„** | ë§¤ì¼ 00:30 (KST) |
| **Cron í‘œí˜„ì‹** | `0 30 0 * * ?` |
| **ì—­í• ** | Vertex AI ì˜ˆì¸¡ ê¸°ë°˜ ìë™ ë§¤ìˆ˜ ì‹¤í–‰ |
| **êµ¬í˜„ ìƒíƒœ** | âœ… êµ¬í˜„ ì™„ë£Œ |

**ì‹¤í–‰ íƒ€ì´ë° ê·¼ê±°:**
- **ë¯¸êµ­ ì •ê·œì¥ ê°œì¥**: 23:30 KST (09:30 ET)
- **00:30 ì‹¤í–‰**: ê°œì¥ 1ì‹œê°„ í›„
- **ë³€ë™ì„± íŒ¨í„´**:
  - ì²« 30ë¶„: ì¼ì¼ ìµœê³ ê°€ì˜ 24% ë°œìƒ (ê°€ì¥ ë†’ì€ ë³€ë™ì„±)
  - 30ë¶„~1ì‹œê°„: ë³€ë™ì„± ê°ì†Œ, íŠ¸ë Œë“œ í™•ì • ì‹œì‘
  - 1ì‹œê°„ ì´í›„: ì•ˆì •ì ì¸ íŠ¸ë Œë“œ ì§„ì… êµ¬ê°„
- **ì•ˆì „í•œ ì§„ì…**: ì´ˆê¸° ë³€ë™ì„± íšŒí”¼, í™•ì •ëœ íŠ¸ë Œë“œì—ì„œ ë§¤ìˆ˜

**ì‹¤í–‰ íë¦„:**
```
00:30 â†’ AutoBuyJobAdapter
      â†’ AutoTradingUseCase.executeAutoBuy()
      â†’ Vertex AI ì˜ˆì¸¡ ê²°ê³¼ ì¡°íšŒ
      â†’ ë§¤ìˆ˜ ì‹ í˜¸ í•„í„°ë§ (ì‹ ë¢°ë„ ì„ê³„ê°’)
      â†’ KIS API ë§¤ìˆ˜ ì£¼ë¬¸ ì‹¤í–‰
      â†’ ì£¼ë¬¸ ê²°ê³¼ ì €ì¥ ë° ì•Œë¦¼
```

#### 8. ìë™ ë§¤ë„ ì²´í¬ (AutoSellJobAdapter)

| ì†ì„± | ê°’ |
|------|-----|
| **Job ì´ë¦„** | `autoSellJob` |
| **Trigger ì´ë¦„** | `autoSellTrigger` |
| **ì‹¤í–‰ ì‹œê°„** | **ë§¤ 1ë¶„ë§ˆë‹¤ (ë°˜ë³µ)** |
| **ìŠ¤ì¼€ì¤„ íƒ€ì…** | SimpleSchedule |
| **ì—­í• ** | ì‹¤ì‹œê°„ ë§¤ë„ ì¡°ê±´ í™•ì¸ ë° ì‹¤í–‰ |
| **ì‹œì¥ ì‹œê°„ ê²€ì¦** | ë¯¸êµ­ ì‹œì¥ ì‹œê°„ë§Œ (í‰ì¼ 9:30 AM - 4:00 PM ET) |
| **êµ¬í˜„ ìƒíƒœ** | âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-01) |

**ì‹¤í–‰ íë¦„:**
```
ë§¤ 1ë¶„ â†’ AutoSellJobAdapter
       â†’ isUsMarketHours() ì²´í¬
       â†’ (ë¯¸êµ­ ì‹œì¥ ì‹œê°„ì´ë©´)
       â†’ AutoTradingUseCase.checkAndExecuteSellOrders()
       â†’ ë§¤ë„ ì¡°ê±´ í™•ì¸ (ì†ì ˆ/ìµì ˆ)
       â†’ ë§¤ë„ ì£¼ë¬¸ ì‹¤í–‰
```

**ë¯¸êµ­ ì‹œì¥ ì‹œê°„ ê²€ì¦:**
```kotlin
private fun isUsMarketHours(): Boolean {
    val nyTime = ZonedDateTime.now(ZoneId.of("America/New_York"))
    val hour = nyTime.hour
    val minute = nyTime.minute
    val dayOfWeek = nyTime.dayOfWeek

    // ì£¼ë§ ì œì™¸
    if (dayOfWeek == DayOfWeek.SATURDAY || dayOfWeek == DayOfWeek.SUNDAY) {
        return false
    }

    // 9:30 AM - 4:00 PM ET
    if (hour < 9 || (hour == 9 && minute < 30) || hour >= 16) {
        return false
    }

    return true
}
```

**íŠ¹ì§•:**
- banbu-stocktrading ìŠ¤íƒ€ì¼ ì‹¤ì‹œê°„ ë§¤ë„ ëª¨ë‹ˆí„°ë§
- ë¯¸êµ­ ì‹œì¥ ì‹œê°„ ì™¸ì—ëŠ” ê±´ë„ˆëœ€ (ë¦¬ì†ŒìŠ¤ ì ˆì•½)
- í‰ì¼ë§Œ ì‹¤í–‰ (ì£¼ë§ ì œì™¸)
- ë§¤ 1ë¶„ë§ˆë‹¤ ë°˜ë³µ ì‹¤í–‰ (SimpleSchedule)

---

## MongoDB ì»¬ë ‰ì…˜ ë°ì´í„° íë¦„

### ìŠ¤ì¼€ì¤„ëŸ¬ë³„ ë°ì´í„° ì €ì¥ ë§¤í•‘

ê° ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì–´ë–¤ MongoDB ì»¬ë ‰ì…˜ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ”ì§€ ì •ë¦¬í•©ë‹ˆë‹¤.

| ì»¬ë ‰ì…˜ | ìŠ¤ì¼€ì¤„ëŸ¬ | ì‹¤í–‰ ì‹œê°„ | ì—…ë°ì´íŠ¸ ì£¼ê¸° | ì„¤ëª… |
|--------|---------|----------|--------------|------|
| `daily_stock_data` | economicDataUpdate2Job | 22:00 (ë§¤ì¼) | ì¼ì¼ | FRED + Yahoo Finance í†µí•© ê²½ì œ ì§€í‘œ |
| `stock_predictions` | economicDataUpdate2Job | 22:00 (ë§¤ì¼) | ì¼ì¼ | Vertex AI ì˜ˆì¸¡ ê²°ê³¼ |
| `stock_recommendations` | combinedAnalysisJob | 01:30 (ë§¤ì¼) | ì¼ì¼ | ê¸°ìˆ ì  ë¶„ì„ ê¸°ë°˜ ë§¤ìˆ˜ ì¶”ì²œ |
| `sentiment_analysis` | sentimentAnalysisJob | 02:30 (ë§¤ì¼) | ì¼ì¼ | ë‰´ìŠ¤ ê°ì • ë¶„ì„ ê²°ê³¼ |
| `yfinance_indicators` | (ì„¤ì • ë°ì´í„°) | - | ìˆ˜ë™ | Yahoo Finance ì§€í‘œ ì •ì˜ |
| `fred_indicators` | (ì„¤ì • ë°ì´í„°) | - | ìˆ˜ë™ | FRED ì§€í‘œ ì •ì˜ |
| `access_tokens` | KIS API | ì‹¤ì‹œê°„ | í•„ìš”ì‹œ | KIS ì•¡ì„¸ìŠ¤ í† í° ìºì‹œ |
| `stocks` | (ë§ˆìŠ¤í„° ë°ì´í„°) | - | ìˆ˜ë™ | ì¢…ëª© ì •ë³´ |

### ì»¬ë ‰ì…˜ ìƒíƒœ í™•ì¸ (2026-02-01 ê¸°ì¤€)

```bash
# MongoDB ì»¬ë ‰ì…˜ ë°ì´í„° ê±´ìˆ˜ ì¡°íšŒ
docker compose exec -T mongodb mongosh -u quantiq_user -p quantiq_password \
  --authenticationDatabase admin stock_trading --eval "
    db.daily_stock_data.countDocuments({})      // 7,335ê±´ (ìµœì‹ : 2026-01-30) âœ…
    db.stock_predictions.countDocuments({})     // 781,923ê±´ (ìµœì‹ : 2026-01-28) âš ï¸
    db.stock_recommendations.countDocuments({}) // 2,572ê±´ (ìµœì‹ : 2026-01-28) âš ï¸
    db.yfinance_data.countDocuments({})         // 91ê±´ (ìµœì‹ : 2026-01-02) âŒ
    db.fred_data.countDocuments({})             // 38ê±´ (ìµœì‹ : 2026-01-01) âŒ
  " --quiet
```

### ì£¼ìš” ì»¬ë ‰ì…˜ ìƒì„¸ ì„¤ëª…

#### 1. daily_stock_data (ê²½ì œ ì§€í‘œ í†µí•©)

**ì—…ë°ì´íŠ¸ ìŠ¤ì¼€ì¤„ëŸ¬**: `economicDataUpdate2Job` (ë§¤ì¼ 22:00)

**ë°ì´í„° êµ¬ì¡°**:
```json
{
  "_id": "697ea5af4e4e84c5314f95d4",
  "date": "2026-01-30",
  "fred_indicators": {
    "GDP": 28269.5,
    "Unemployment_Rate": 4.1,
    "Inflation_CPI": 318.5,
    "Treasury_10Y": 4.5,
    "USD_KRW": 1350.5
  },
  "yfinance_indicators": {
    "SP500": 6939.02,
    "Dow_Jones": 48892.46,
    "NASDAQ": 23461.82,
    "KOSPI": 5224.35,
    "Gold": 4713.89
  },
  "updated_at": "2026-02-01T10:00:31.251Z"
}
```

**ì—…ë°ì´íŠ¸ íë¦„**:
```
22:00 â†’ EconomicDataUpdate2JobAdapter
      â†’ economicDataUseCase.triggerEconomicDataUpdate()
      â†’ Kafka: economic.data.update.request
      â†’ Python Data Engine: EconomicDataService.collect_economic_data()
      â†’ FRED API + Yahoo Finance ë°ì´í„° ìˆ˜ì§‘ (ìµœê·¼ 365ì¼)
      â†’ MongoDB: daily_stock_data ì €ì¥
```

**ë°ì´í„° ìˆ˜ì§‘ ë²”ìœ„**:
- **FRED ì§€í‘œ**: GDP, ì‹¤ì—…ë¥ , CPI, 10ë…„ë¬¼ êµ­ì±„ ê¸ˆë¦¬, USD/KRW í™˜ìœ¨
- **Yahoo Finance ì§€í‘œ**: S&P500, Dow Jones, NASDAQ, KOSPI, Gold
- **ê¸°ê°„**: ìµœê·¼ 365ì¼ (ë¶„ê¸°ë³„/ì›”ë³„/ì¼ë³„ ì§€í‘œ ë°˜ì˜)

#### 2. stock_predictions (Vertex AI ì˜ˆì¸¡)

**ì—…ë°ì´íŠ¸ ìŠ¤ì¼€ì¤„ëŸ¬**: `economicDataUpdate2Job` (ë§¤ì¼ 22:00)

**ë°ì´í„° êµ¬ì¡°**:
```json
{
  "_id": "697b539afbb7eeabaa3449ca",
  "date": "2026-01-28T00:00:00.000Z",
  "ticker": "GOOGL",
  "predicted_price": 336.91,
  "actual_price": 327.93,
  "forecast_horizon": 14,
  "created_at": "2026-01-28T14:16:08.933Z",
  "updated_at": "2026-01-28T14:16:08.933Z"
}
```

**ì—…ë°ì´íŠ¸ íë¦„**:
```
22:00 â†’ EconomicDataUpdate2JobAdapter
      â†’ runVertexAIPrediction()
      â†’ Python: run_predict_vertex_ai.py
      â†’ Vertex AI CustomJob ìƒì„±
      â†’ Transformer ëª¨ë¸ Fine-tuning (5 epochs)
      â†’ ì˜ˆì¸¡ ê²°ê³¼ â†’ MongoDB: stock_predictions ì €ì¥
```

**ì˜ˆì¸¡ ëŒ€ìƒ ì¢…ëª©**: S&P 500 ìƒìœ„ 50ê°œ ì¢…ëª©
**ì˜ˆì¸¡ ê¸°ê°„**: 14ì¼ í›„ ì¢…ê°€

#### 3. stock_recommendations (ë§¤ìˆ˜ ì¶”ì²œ)

**ì—…ë°ì´íŠ¸ ìŠ¤ì¼€ì¤„ëŸ¬**: `combinedAnalysisJob` (ë§¤ì¼ 01:30)

**ë°ì´í„° êµ¬ì¡°**:
```json
{
  "_id": "697b5389fbb7eeabaa304fca",
  "date": "2026-01-28",
  "ticker": "AAPL",
  "is_recommended": true,
  "recommendation_score": 0.85,
  "technical_indicators": {
    "sma20": 150.5,
    "sma50": 145.2,
    "golden_cross": true,
    "rsi": 65.3,
    "macd": 2.5,
    "signal": 1.8,
    "macd_buy_signal": true
  },
  "user_id": "lian",
  "stock_id": "AAPL_001",
  "created_at": "2026-01-28T14:30:25.928Z",
  "updated_at": "2026-01-28T14:30:25.928Z"
}
```

**ì—…ë°ì´íŠ¸ íë¦„**:
```
01:30 â†’ CombinedAnalysisJobAdapter
      â†’ Kafka: analysis.combined.request
      â†’ Python: TechnicalAnalysisService.analyze()
      â†’ ê¸°ìˆ ì  ì§€í‘œ ê³„ì‚° (SMA, RSI, MACD)
      â†’ MongoDB: stock_recommendations ì €ì¥
```

### ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë ˆê±°ì‹œ ì»¬ë ‰ì…˜

ë‹¤ìŒ ì»¬ë ‰ì…˜ë“¤ì€ í˜„ì¬ ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤:

| ì»¬ë ‰ì…˜ | ìƒíƒœ | ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ | ê¶Œì¥ ì¡°ì¹˜ |
|--------|------|-----------------|----------|
| `yfinance_data` | âš ï¸ ì‚¬ìš© ì•ˆ í•¨ | 2026-01-02 | ì œê±° ë˜ëŠ” ì•„ì¹´ì´ë¸Œ |
| `fred_data` | âš ï¸ ì‚¬ìš© ì•ˆ í•¨ | 2026-01-01 | ì œê±° ë˜ëŠ” ì•„ì¹´ì´ë¸Œ |

**ì´ìœ **:
- ê¸°ì¡´ì—ëŠ” `yfinance_data`ì™€ `fred_data`ì— ì›ë³¸ ë°ì´í„°ë¥¼ ì €ì¥í–ˆìœ¼ë‚˜,
- í˜„ì¬ëŠ” `daily_stock_data`ì— í†µí•©í•˜ì—¬ ì €ì¥í•˜ë¯€ë¡œ ë¶ˆí•„ìš”
- ë°ì´í„° ì¤‘ë³µ ë°©ì§€ ë° ìŠ¤í† ë¦¬ì§€ ìµœì í™”

### ìˆ˜ë™ íŠ¸ë¦¬ê±°ë¥¼ í†µí•œ ë°ì´í„° ìˆ˜ì§‘

ìŠ¤ì¼€ì¤„ëŸ¬ ëŒ€ê¸° ì—†ì´ ì¦‰ì‹œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ë ¤ë©´ REST APIë¥¼ ì‚¬ìš©:

```bash
# ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ (daily_stock_data ì—…ë°ì´íŠ¸)
curl -X POST http://localhost:10010/api/economic/trigger-update

# ê¸°ìˆ ì  ë¶„ì„ (stock_recommendations ì—…ë°ì´íŠ¸)
curl -X POST http://localhost:10010/api/analysis/trigger-technical

# ê°ì • ë¶„ì„
curl -X POST http://localhost:10010/api/analysis/trigger-sentiment

# í†µí•© ë¶„ì„
curl -X POST http://localhost:10010/api/analysis/trigger-combined

# ë³‘ë ¬ ë¶„ì„
curl -X POST http://localhost:10010/api/analysis/trigger-parallel
```

---

## ë°ì´í„° ì €ì¥ì†Œ

### PostgreSQL í…Œì´ë¸” êµ¬ì¡°

QuartzëŠ” ìŠ¤ì¼€ì¤„ ì •ë³´ë¥¼ PostgreSQLì— ì €ì¥í•˜ì—¬ ì˜ì†ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

#### ì£¼ìš” í…Œì´ë¸”

| í…Œì´ë¸” | ì—­í•  | ì£¼ìš” ì»¬ëŸ¼ |
|--------|------|----------|
| `quartz_job_details` | Job ë©”íƒ€ë°ì´í„° | job_name, job_class_name, is_durable |
| `quartz_triggers` | íŠ¸ë¦¬ê±° ì •ë³´ | trigger_name, next_fire_time, trigger_state |
| `quartz_cron_triggers` | Cron íŠ¸ë¦¬ê±° | cron_expression, time_zone_id |
| `quartz_fired_triggers` | ì‹¤í–‰ ì¤‘ì¸ Job | fired_time, state, instance_name |
| `quartz_scheduler_state` | ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ | instance_name, last_checkin_time |
| `quartz_locks` | ë¶„ì‚° ë½ | lock_name |

#### í…Œì´ë¸” ê´€ê³„ë„

```
quartz_job_details (ë¶€ëª¨)
    â†“ FK
quartz_triggers
    â†“ FK
quartz_cron_triggers (Cron íƒ€ì…ì¼ ë•Œ)
quartz_simple_triggers (Simple íƒ€ì…ì¼ ë•Œ)
quartz_simprop_triggers (Property íƒ€ì…ì¼ ë•Œ)
```

#### ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼

- **ìœ„ì¹˜**: `quantiq-core/src/main/resources/db/migration/V3__Create_Quartz_Tables.sql`
- **ì ìš© ì‹œì **: Flywayê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ìë™ ì‹¤í–‰
- **ë²„ì „**: V3 (ê²½ì œ ë°ì´í„° í…Œì´ë¸” ì´í›„)

### ìŠ¤ì¼€ì¤„ ì¡°íšŒ ì¿¼ë¦¬ ì˜ˆì‹œ

```sql
-- ëª¨ë“  ìŠ¤ì¼€ì¤„ ì¡°íšŒ
SELECT
    t.trigger_name,
    t.job_name,
    t.next_fire_time,
    t.prev_fire_time,
    t.trigger_state,
    ct.cron_expression,
    ct.time_zone_id
FROM quartz_triggers t
LEFT JOIN quartz_cron_triggers ct
    ON t.trigger_name = ct.trigger_name;

-- ì‹¤í–‰ ì˜ˆì • ì‹œê°„ í™•ì¸
SELECT
    trigger_name,
    to_timestamp(next_fire_time / 1000) AT TIME ZONE 'Asia/Seoul' as next_run,
    trigger_state
FROM quartz_triggers
WHERE trigger_state = 'WAITING'
ORDER BY next_fire_time;
```

---

## ì´ë²¤íŠ¸ ê¸°ë°˜ í†µí•©

### Kafka ì´ë²¤íŠ¸ ì—°ë™

ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” **ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜**ì™€ í†µí•©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

#### ë°œí–‰ ì´ë²¤íŠ¸ (Scheduler â†’ Kafka)

| ì´ë²¤íŠ¸ í† í”½ | ë°œí–‰ì | íƒ€ì´ë° | í˜ì´ë¡œë“œ |
|------------|--------|--------|----------|
| `quantiq.economic.data.request` | EconomicDataUpdate2JobAdapter | ë§¤ì¼ 22:00 | `{"requestedAt": "2026-02-01T22:00:00"}` |
| `quantiq.analysis.request` | ParallelAnalysisJob (ì˜ˆì •) | ë§¤ì¼ 23:05 | `{"type": "VALIDATION", "requestedAt": "..."}` |
| `quantiq.trading.buy.executed` | AutoBuyJobAdapter | ë§¤ì¼ 00:30 | `{"symbol": "AAPL", "quantity": 10, "price": 150.0}` |

#### êµ¬ë… ì´ë²¤íŠ¸ (Kafka â†’ Scheduler)

| ì´ë²¤íŠ¸ í† í”½ | êµ¬ë…ì | ì²˜ë¦¬ ë‚´ìš© |
|------------|--------|----------|
| `quantiq.economic.data.completed` | KafkaMessageListener | ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ ì²˜ë¦¬ |
| `quantiq.analysis.completed` | KafkaMessageListener | ë¶„ì„ ì™„ë£Œ ì²˜ë¦¬ (AutoTrading íŠ¸ë¦¬ê±°) |

### ì´ë²¤íŠ¸ íë¦„ ì˜ˆì‹œ

**ì „ì²´ ìë™ ë§¤ë§¤ í”Œë¡œìš° (ì¼ì¼ ì£¼ê¸°):**
```
[22:00] ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ + Vertex AI ì˜ˆì¸¡
    â†“
EconomicDataUpdate2JobAdapter.execute()
    â†“
1) economicDataUseCase.triggerEconomicDataUpdate()
    â†’ Kafka: quantiq.economic.data.request
    â†’ Data Engine: ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ (FRED, Yahoo Finance)
    â†’ MongoDB: daily_stock_data ì—…ë°ì´íŠ¸
    â†“
2) runVertexAIPrediction()
    â†’ Python: run_predict_vertex_ai.py
    â†’ Vertex AI: CustomJob ìƒì„±
    â†’ GPU Fine-tuning (3-5ë¶„)
    â†’ GCS: ëª¨ë¸/Scaler ì €ì¥
    â†’ MongoDB: ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥
    â†“
[23:05] ì˜ˆì¸¡ ê²€ì¦ (ê¸°ìˆ ì  ì§€í‘œ)
    â†’ ParallelAnalysisJob (TODO)
    â†’ ê¸°ìˆ ì  ë¶„ì„ìœ¼ë¡œ ì˜ˆì¸¡ ê²€ì¦
    â†“
[00:30] ìë™ ë§¤ìˆ˜
    â†’ AutoBuyJobAdapter
    â†’ Vertex AI ì˜ˆì¸¡ ê²°ê³¼ ì¡°íšŒ
    â†’ ë§¤ìˆ˜ ì‹ í˜¸ í•„í„°ë§
    â†’ KIS API ë§¤ìˆ˜ ì£¼ë¬¸
    â†’ Slack ì•Œë¦¼
    â†“
[01:30] ë§¤ìˆ˜ í›„ ê²€ì¦
    â†’ CombinedAnalysisJobAdapter
    â†’ ê¸°ìˆ ì  ë¶„ì„ (70%) + ê°ì • ë¶„ì„ (30%)
    â†’ ë§¤ìˆ˜ ê²°ì • ì¬í‰ê°€
    â†“
[02:30] ê°ì • ë¶„ì„ ì¬ê²€ì¦
    â†’ SentimentAnalysisJob (TODO)
    â†’ ë‰´ìŠ¤ ê°ì • ë¶„ì„
    â†’ ë§¤ìˆ˜ ìœ ì§€/ì·¨ì†Œ íŒë‹¨
    â†“
[ë§¤ 1ë¶„] ìë™ ë§¤ë„ (ë¯¸êµ­ ì‹œì¥ ì‹œê°„)
    â†’ AutoSellJobAdapter
    â†’ ì†ì ˆ/ìµì ˆ ì¡°ê±´ ì²´í¬
    â†’ ë§¤ë„ ì£¼ë¬¸ ì‹¤í–‰
```

### ì´ë²¤íŠ¸ ìŠ¤í‚¤ë§ˆ

ìì„¸í•œ ì´ë²¤íŠ¸ ìŠ¤í‚¤ë§ˆëŠ” [EVENT_SCHEMA.md](./EVENT_SCHEMA.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

---

## ì£¼ìš” í´ë˜ìŠ¤ ì°¸ì¡°

| í´ë˜ìŠ¤ | ê²½ë¡œ | ì—­í•  |
|--------|------|------|
| `QuartzConfig` | `scheduler/QuartzConfig.kt` | Job ë° Trigger ë“±ë¡ |
| `EconomicDataUpdateJobAdapter` | `adapter/input/scheduler/` | ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ Job |
| `ParallelAnalysisJob` | `scheduler/ParallelAnalysisJob.kt` | ë³‘ë ¬ ë¶„ì„ Job |
| `SchedulerRestController` | `adapter/input/rest/` | REST API ì—”ë“œí¬ì¸íŠ¸ |
| `SchedulerManagementService` | `application/scheduler/` | UseCase êµ¬í˜„ì²´ |
| `QuartzSchedulerAdapter` | `adapter/output/persistence/` | Quartz ì—°ë™ Adapter |
| `SchedulerUseCase` | `domain/scheduler/port/input/` | Input Port |
| `SchedulerRepository` | `domain/scheduler/port/output/` | Output Port |

---

## ì„¤ì • íŒŒì¼

### application.yml

```yaml
spring:
  quartz:
    job-store-type: jdbc          # PostgreSQL ì‚¬ìš©
    jdbc:
      initialize-schema: never     # Flywayê°€ ìŠ¤í‚¤ë§ˆ ê´€ë¦¬
    properties:
      org.quartz.scheduler.instanceName: QuantIQScheduler
      org.quartz.scheduler.instanceId: AUTO
      org.quartz.jobStore.class: org.quartz.impl.jdbcjobstore.JobStoreTX
      org.quartz.jobStore.driverDelegateClass: org.quartz.impl.jdbcjobstore.PostgreSQLDelegate
      org.quartz.jobStore.tablePrefix: quartz_
      org.quartz.jobStore.isClustered: true  # í´ëŸ¬ìŠ¤í„°ë§ ì§€ì›
      org.quartz.threadPool.threadCount: 10
```

### Gradle ì˜ì¡´ì„±

```kotlin
dependencies {
    implementation("org.springframework.boot:spring-boot-starter-quartz")
    implementation("org.postgresql:postgresql")
}
```

---

## í™•ì¥ ê°€ëŠ¥ì„±

### ìƒˆ Job ì¶”ê°€ ë°©ë²•

1. **Job í´ë˜ìŠ¤ ì‘ì„±**
```kotlin
@Component
class NewAnalysisJob : Job {
    override fun execute(context: JobExecutionContext?) {
        // Job ë¡œì§
    }
}
```

2. **QuartzConfigì— ë“±ë¡**
```kotlin
@Bean
fun newAnalysisJobDetail(): JobDetail {
    return JobBuilder.newJob(NewAnalysisJob::class.java)
        .withIdentity("newAnalysisJob")
        .storeDurably()
        .build()
}

@Bean
fun newAnalysisTrigger(): Trigger {
    return TriggerBuilder.newTrigger()
        .forJob(newAnalysisJobDetail())
        .withSchedule(CronScheduleBuilder.cronSchedule("0 0 12 * * ?"))
        .build()
}
```

### í´ëŸ¬ìŠ¤í„°ë§ ê³ ë ¤ì‚¬í•­

- QuartzëŠ” PostgreSQL ë½ì„ ì‚¬ìš©í•˜ì—¬ ë¶„ì‚° í™˜ê²½ì—ì„œ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
- `quartz_locks` í…Œì´ë¸”ì„ í†µí•œ ë¶„ì‚° ë½ ê´€ë¦¬
- ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ê°€ ë™ì‹œì— ì‹¤í–‰ë˜ì–´ë„ ì•ˆì „

---

## ê´€ë ¨ ë¬¸ì„œ

- [ìŠ¤ì¼€ì¤„ëŸ¬ ìš´ì˜ ê°€ì´ë“œ](../setup/SCHEDULER_GUIDE.md)
- [ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ](./EVENT_DRIVEN_GUIDE.md)
- [ì´ë²¤íŠ¸ ìŠ¤í‚¤ë§ˆ](./EVENT_SCHEMA.md)
- [ìŠ¤ì¼€ì¤„ëŸ¬ ë§ˆì´ê·¸ë ˆì´ì…˜ TODO](../todo/ìŠ¤ì¼€ì¤„ëŸ¬_ë§ˆì´ê·¸ë ˆì´ì…˜_TODO.md)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-02-01
**ë²„ì „**: 2.0 (Vertex AI í†µí•© ë° ìŠ¤ì¼€ì¤„ ìµœì í™”)
**ì‘ì„±ì**: QuantIQ Development Team

**ì£¼ìš” ë³€ê²½ì‚¬í•­ (v2.0):**
- ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ ì‹œê°„ ë³€ê²½: 06:05 â†’ 22:00 (ë¯¸êµ­ ê²½ì œ ì§€í‘œ ë°œí‘œ íƒ€ì´ë° ìµœì í™”)
- Google Vertex AI CustomJob í†µí•© (Fine-tuning ëª¨ë“œë¡œ 83% ì„±ëŠ¥ ê°œì„ )
- ìë™ ë§¤ìˆ˜ ì‹œê°„ ë³€ê²½: 23:50 â†’ 00:30 (ì‹œì¥ ê°œì¥ 1ì‹œê°„ í›„, ë³€ë™ì„± ì•ˆì •í™”)
- ì „ì²´ ìŠ¤ì¼€ì¤„ ì¬êµ¬ì„±: ë°ì´í„° ìˆ˜ì§‘ â†’ ì˜ˆì¸¡ â†’ ê²€ì¦ â†’ ë§¤ìˆ˜ â†’ ì¬ê²€ì¦ í”Œë¡œìš°
