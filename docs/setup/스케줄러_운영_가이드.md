# ìŠ¤ì¼€ì¤„ëŸ¬ ìš´ì˜ ê°€ì´ë“œ

**ëª©ì **: QuantIQ ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë¦¬ ë° ìš´ì˜ ì‹¤ë¬´ ê°€ì´ë“œ
**ëŒ€ìƒ**: ì‹œìŠ¤í…œ ê´€ë¦¬ì, DevOps ì—”ì§€ë‹ˆì–´
**ì‘ì„±ì¼**: 2026-01-31

---

## ğŸ“‹ ëª©ì°¨

1. [ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘/ì¤‘ì§€](#ìŠ¤ì¼€ì¤„ëŸ¬-ì‹œì‘ì¤‘ì§€)
2. [ìŠ¤ì¼€ì¤„ ê´€ë¦¬](#ìŠ¤ì¼€ì¤„-ê´€ë¦¬)
3. [ëª¨ë‹ˆí„°ë§](#ëª¨ë‹ˆí„°ë§)
4. [ë¡œê·¸ í™•ì¸](#ë¡œê·¸-í™•ì¸)
5. [ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ ê´€ë¦¬](#ë°ì´í„°ë² ì´ìŠ¤-ì§ì ‘-ê´€ë¦¬)
6. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
7. [ì„±ëŠ¥ íŠœë‹](#ì„±ëŠ¥-íŠœë‹)

---

## ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘/ì¤‘ì§€

### REST APIë¥¼ í†µí•œ ì œì–´

#### ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘

```bash
curl -X POST http://localhost:8080/api/scheduler/start

# ì‘ë‹µ
{
  "success": true,
  "message": "ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€

```bash
curl -X POST http://localhost:8080/api/scheduler/stop

# ì‘ë‹µ
{
  "success": true,
  "message": "ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ì¡°íšŒ

```bash
curl -X GET http://localhost:8080/api/scheduler/status

# ì‘ë‹µ
{
  "isRunning": true,
  "scheduledJobCount": 2,
  "activeTriggerCount": 2
}
```

### Dockerë¥¼ í†µí•œ ì œì–´

#### ìŠ¤ì¼€ì¤„ëŸ¬ ì¬ì‹œì‘

```bash
# quantiq-core ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose restart quantiq-core

# ë¡œê·¸ í™•ì¸
docker-compose logs -f quantiq-core | grep -i "scheduler"
```

#### ìŠ¤ì¼€ì¤„ëŸ¬ í¬í•¨ ì „ì²´ ì¬ì‹œì‘

```bash
# ì „ì²´ ì‹œìŠ¤í…œ ì¬ì‹œì‘
docker-compose down
docker-compose up -d

# ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘ í™•ì¸
docker-compose logs quantiq-core | grep "Scheduler started"
```

### ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •

#### application.yml ì„¤ì •

```yaml
spring:
  quartz:
    # ìŠ¤ì¼€ì¤„ëŸ¬ ìë™ ì‹œì‘ ì—¬ë¶€
    auto-startup: true

    # ì‹œì‘ ì§€ì—° ì‹œê°„ (ì´ˆ)
    startup-delay: 10

    # Job ì‹¤í–‰ ëŒ€ê¸° ì‹œ ì˜¤ë²„ë¼ì´ë“œ ì—¬ë¶€
    overwrite-existing-jobs: false
```

---

## ìŠ¤ì¼€ì¤„ ê´€ë¦¬

### ë“±ë¡ëœ ìŠ¤ì¼€ì¤„ ì¡°íšŒ

#### ëª¨ë“  ìŠ¤ì¼€ì¤„ ì¡°íšŒ

```bash
curl -X GET http://localhost:8080/api/scheduler/schedules

# ì‘ë‹µ
{
  "economicDataUpdateTrigger": {
    "triggerName": "economicDataUpdateTrigger",
    "jobName": "economicDataUpdateJob",
    "nextFireTime": "2026-01-31T06:05:00.000+00:00",
    "previousFireTime": "2026-01-30T06:05:00.000+00:00",
    "state": "WAITING"
  },
  "parallelAnalysisTrigger": {
    "triggerName": "parallelAnalysisTrigger",
    "jobName": "parallelAnalysisJob",
    "nextFireTime": "2026-01-31T23:05:00.000+00:00",
    "previousFireTime": "2026-01-30T23:05:00.000+00:00",
    "state": "WAITING"
  }
}
```

### ìŠ¤ì¼€ì¤„ ì¼ì‹œ ì¤‘ì§€ (Pause)

#### íŠ¹ì • ìŠ¤ì¼€ì¤„ ì¼ì‹œ ì¤‘ì§€

```bash
curl -X POST http://localhost:8080/api/scheduler/schedules/economicDataUpdateTrigger/pause

# ì‘ë‹µ
{
  "success": true,
  "message": "ìŠ¤ì¼€ì¤„ì´ ì¼ì‹œ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### íš¨ê³¼
- í•´ë‹¹ Triggerì˜ ìƒíƒœê°€ `WAITING` â†’ `PAUSED`ë¡œ ë³€ê²½
- ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ì´ ë˜ì–´ë„ Jobì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
- Resume ì „ê¹Œì§€ ê³„ì† ì¤‘ì§€ ìƒíƒœ ìœ ì§€

### ìŠ¤ì¼€ì¤„ ì¬ê°œ (Resume)

```bash
curl -X POST http://localhost:8080/api/scheduler/schedules/economicDataUpdateTrigger/resume

# ì‘ë‹µ
{
  "success": true,
  "message": "ìŠ¤ì¼€ì¤„ì´ ì¬ê°œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

#### íš¨ê³¼
- Trigger ìƒíƒœê°€ `PAUSED` â†’ `WAITING`ë¡œ ë³€ê²½
- ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ì— ì •ìƒì ìœ¼ë¡œ Job ì‹¤í–‰

### Trigger ìƒíƒœ ì„¤ëª…

| ìƒíƒœ | ì„¤ëª… |
|------|------|
| `WAITING` | ë‹¤ìŒ ì‹¤í–‰ì„ ê¸°ë‹¤ë¦¬ëŠ” ì •ìƒ ìƒíƒœ |
| `PAUSED` | ì¼ì‹œ ì¤‘ì§€ëœ ìƒíƒœ (ì‹¤í–‰ ì•ˆ ë¨) |
| `ACQUIRED` | ì‹¤í–‰ì„ ìœ„í•´ íšë“ëœ ìƒíƒœ |
| `EXECUTING` | í˜„ì¬ ì‹¤í–‰ ì¤‘ |
| `COMPLETE` | ì‹¤í–‰ ì™„ë£Œ (ì¬ì‹¤í–‰ ì—†ìŒ) |
| `BLOCKED` | ì´ì „ ì‹¤í–‰ì´ ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì•„ ëŒ€ê¸° ì¤‘ |
| `ERROR` | ì˜¤ë¥˜ ìƒíƒœ |

---

## ëª¨ë‹ˆí„°ë§

### ìŠ¤ì¼€ì¤„ ì‹¤í–‰ ìƒíƒœ ëª¨ë‹ˆí„°ë§

#### ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ í™•ì¸

```bash
# PostgreSQL ì¿¼ë¦¬
docker-compose exec postgresql psql -U quantiq_user -d quantiq << 'EOF'
SELECT
    trigger_name,
    to_timestamp(next_fire_time / 1000) AT TIME ZONE 'Asia/Seoul' as next_run_kst,
    to_timestamp(prev_fire_time / 1000) AT TIME ZONE 'Asia/Seoul' as prev_run_kst,
    trigger_state
FROM quartz_triggers
ORDER BY next_fire_time;
EOF
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
        trigger_name         |     next_run_kst     |     prev_run_kst     | trigger_state
-----------------------------+----------------------+----------------------+--------------
 economicDataUpdateTrigger   | 2026-01-31 06:05:00  | 2026-01-30 06:05:00  | WAITING
 parallelAnalysisTrigger     | 2026-01-31 23:05:00  | 2026-01-30 23:05:00  | WAITING
```

#### ì‹¤í–‰ ì¤‘ì¸ Job í™•ì¸

```bash
docker-compose exec postgresql psql -U quantiq_user -d quantiq << 'EOF'
SELECT
    trigger_name,
    job_name,
    to_timestamp(fired_time / 1000) AT TIME ZONE 'Asia/Seoul' as fired_time_kst,
    state,
    instance_name
FROM quartz_fired_triggers
WHERE state = 'EXECUTING';
EOF
```

### ì‹¤í–‰ ì´ë ¥ ì¡°íšŒ

#### Job ì‹¤í–‰ í†µê³„

```bash
# ìµœê·¼ ì‹¤í–‰ ì´ë ¥ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ ê¸°ë°˜)
docker-compose logs quantiq-core --since 24h | grep -E "(ê²½ì œ ë°ì´í„°|ë³‘ë ¬ ë¶„ì„)" | grep "ì‹œì‘\|ì™„ë£Œ\|ì‹¤íŒ¨"
```

#### ì‹¤í–‰ ì„±ê³µë¥  í™•ì¸

```bash
# ì„±ê³µí•œ ì‹¤í–‰
docker-compose logs quantiq-core --since 7d | grep "âœ….*ì™„ë£Œ" | wc -l

# ì‹¤íŒ¨í•œ ì‹¤í–‰
docker-compose logs quantiq-core --since 7d | grep "âŒ.*ì‹¤íŒ¨" | wc -l
```

### Grafana ëŒ€ì‹œë³´ë“œ (ê¶Œì¥)

#### ëª¨ë‹ˆí„°ë§ ì§€í‘œ

- **ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ**: `isRunning`, `scheduledJobCount`
- **Job ì‹¤í–‰ íšŸìˆ˜**: ì„±ê³µ/ì‹¤íŒ¨ ì¹´ìš´íŠ¸
- **Job ì‹¤í–‰ ì‹œê°„**: í‰ê· /ìµœëŒ€ ì‹¤í–‰ ì‹œê°„
- **ì—ëŸ¬ìœ¨**: ì‹¤íŒ¨ Job ë¹„ìœ¨

#### Prometheus ë©”íŠ¸ë¦­ ì˜ˆì‹œ (í–¥í›„ êµ¬í˜„)

```yaml
# ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ
quantiq_scheduler_running{instance="quantiq-core"} 1

# Job ì‹¤í–‰ ì¹´ìš´í„°
quantiq_job_executions_total{job="economicDataUpdate", status="success"} 30
quantiq_job_executions_total{job="economicDataUpdate", status="failure"} 2

# Job ì‹¤í–‰ ì‹œê°„
quantiq_job_execution_duration_seconds{job="economicDataUpdate"} 45.3
```

---

## ë¡œê·¸ í™•ì¸

### ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘ ë¡œê·¸

```bash
docker-compose logs quantiq-core | grep "Scheduler"

# ì˜ˆì‹œ ì¶œë ¥
[2026-01-31 00:00:15] INFO  o.q.c.QuartzScheduler - Scheduler QuantIQScheduler_$_AUTO started.
[2026-01-31 00:00:15] INFO  o.q.c.QuartzScheduler - Scheduler meta-data: Quartz Scheduler (v2.3.2) ...
```

### Job ì‹¤í–‰ ë¡œê·¸

#### ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ Job

```bash
docker-compose logs -f quantiq-core | grep "ê²½ì œ ë°ì´í„°"

# ì˜ˆì‹œ ì¶œë ¥
[2026-01-31 06:05:00] INFO  EconomicDataUpdateJobAdapter - ================================================================================
[2026-01-31 06:05:00] INFO  EconomicDataUpdateJobAdapter - ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘ [Trigger: economicDataUpdateTrigger]
[2026-01-31 06:05:00] INFO  EconomicDataUpdateJobAdapter - ================================================================================
[2026-01-31 06:05:05] INFO  EconomicDataUpdateJobAdapter - âœ… ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ ìš”ì²­ ì™„ë£Œ: success
[2026-01-31 06:05:05] INFO  EconomicDataUpdateJobAdapter - ================================================================================
```

#### ë³‘ë ¬ ë¶„ì„ Job

```bash
docker-compose logs -f quantiq-core | grep "ë³‘ë ¬ ë¶„ì„"

# ì˜ˆì‹œ ì¶œë ¥
[2026-01-31 23:05:00] INFO  ParallelAnalysisJob - ============================================================
[2026-01-31 23:05:00] INFO  ParallelAnalysisJob - ë³‘ë ¬ ë¶„ì„ ì‹œì‘ (23:05)
[2026-01-31 23:05:00] INFO  ParallelAnalysisJob - ============================================================
[2026-01-31 23:05:00] INFO  ParallelAnalysisJob - ë³‘ë ¬ ë¶„ì„ ì™„ë£Œ
[2026-01-31 23:05:00] INFO  ParallelAnalysisJob - ============================================================
```

### ì—ëŸ¬ ë¡œê·¸ í•„í„°ë§

```bash
# ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë ¨ ì—ëŸ¬ë§Œ í™•ì¸
docker-compose logs quantiq-core --since 24h | grep -i "error.*scheduler\|error.*job"

# Job ì‹¤í–‰ ì‹¤íŒ¨ ë¡œê·¸
docker-compose logs quantiq-core --since 24h | grep "âŒ"
```

### ë¡œê·¸ íŒŒì¼ ì €ì¥

```bash
# ì˜¤ëŠ˜ì˜ ìŠ¤ì¼€ì¤„ëŸ¬ ë¡œê·¸ ì €ì¥
docker-compose logs quantiq-core --since $(date +%Y-%m-%d) > scheduler-$(date +%Y%m%d).log

# ì—ëŸ¬ ë¡œê·¸ë§Œ ì €ì¥
docker-compose logs quantiq-core --since 7d | grep -i error > scheduler-errors.log
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ ê´€ë¦¬

### PostgreSQL ì ‘ì†

```bash
docker-compose exec postgresql psql -U quantiq_user -d quantiq
```

### ìœ ìš©í•œ ì¿¼ë¦¬

#### 1. ëª¨ë“  Job ëª©ë¡ ì¡°íšŒ

```sql
SELECT
    job_name,
    job_group,
    job_class_name,
    is_durable,
    is_nonconcurrent
FROM quartz_job_details;
```

#### 2. ìŠ¤ì¼€ì¤„ ìƒì„¸ ì •ë³´

```sql
SELECT
    t.trigger_name,
    t.job_name,
    t.trigger_state,
    ct.cron_expression,
    ct.time_zone_id,
    to_timestamp(t.next_fire_time / 1000) AT TIME ZONE 'Asia/Seoul' as next_run,
    to_timestamp(t.prev_fire_time / 1000) AT TIME ZONE 'Asia/Seoul' as prev_run
FROM quartz_triggers t
LEFT JOIN quartz_cron_triggers ct
    ON t.trigger_name = ct.trigger_name
ORDER BY t.next_fire_time;
```

#### 3. ì‹¤í–‰ ì¤‘ì¸ Job í™•ì¸

```sql
SELECT
    job_name,
    trigger_name,
    instance_name,
    to_timestamp(fired_time / 1000) AT TIME ZONE 'Asia/Seoul' as fired_time,
    state
FROM quartz_fired_triggers
WHERE state = 'EXECUTING';
```

#### 4. ì¼ì‹œ ì¤‘ì§€ëœ ìŠ¤ì¼€ì¤„ í™•ì¸

```sql
SELECT
    trigger_name,
    job_name,
    trigger_state
FROM quartz_triggers
WHERE trigger_state = 'PAUSED';
```

#### 5. ìŠ¤ì¼€ì¤„ëŸ¬ í´ëŸ¬ìŠ¤í„° ìƒíƒœ

```sql
SELECT
    instance_name,
    to_timestamp(last_checkin_time / 1000) AT TIME ZONE 'Asia/Seoul' as last_checkin,
    checkin_interval
FROM quartz_scheduler_state;
```

### ìˆ˜ë™ ìŠ¤ì¼€ì¤„ ì¡°ì‘ (ì£¼ì˜)

#### Trigger ìˆ˜ë™ ì¼ì‹œ ì¤‘ì§€

```sql
-- âš ï¸ REST API ì‚¬ìš© ê¶Œì¥, ì§ì ‘ DB ì¡°ì‘ì€ ë¹„ìƒì‹œì—ë§Œ
UPDATE quartz_triggers
SET trigger_state = 'PAUSED'
WHERE trigger_name = 'economicDataUpdateTrigger';
```

#### Trigger ìˆ˜ë™ ì¬ê°œ

```sql
UPDATE quartz_triggers
SET trigger_state = 'WAITING'
WHERE trigger_name = 'economicDataUpdateTrigger';
```

#### Cron í‘œí˜„ì‹ ìˆ˜ì •

```sql
-- âš ï¸ ìŠ¤ì¼€ì¤„ëŸ¬ ì¬ì‹œì‘ í•„ìš”
UPDATE quartz_cron_triggers
SET cron_expression = '0 0 7 * * ?'  -- ë§¤ì¼ 07:00ìœ¼ë¡œ ë³€ê²½
WHERE trigger_name = 'economicDataUpdateTrigger';
```

### ë°ì´í„°ë² ì´ìŠ¤ ì •ë¦¬

#### ì˜¤ë˜ëœ ì‹¤í–‰ ì´ë ¥ ì‚­ì œ

```sql
-- ì‹¤í–‰ ì™„ë£Œëœ íŠ¸ë¦¬ê±° ì •ë³´ ì‚­ì œ (í•„ìš” ì‹œ)
DELETE FROM quartz_fired_triggers
WHERE state = 'COMPLETE'
  AND fired_time < EXTRACT(EPOCH FROM NOW() - INTERVAL '30 days') * 1000;
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹œì‘ë˜ì§€ ì•ŠìŒ

#### ì¦ìƒ
```
ERROR - Scheduler failed to start
```

#### ì›ì¸ ë° í•´ê²°

**1. PostgreSQL ì—°ê²° ì‹¤íŒ¨**
```bash
# í™•ì¸
docker-compose logs quantiq-core | grep -i "connection.*failed\|database.*not.*found"

# í•´ê²°
docker-compose restart postgresql
docker-compose restart quantiq-core
```

**2. Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨**
```bash
# í™•ì¸
docker-compose logs quantiq-core | grep -i "flyway.*failed\|migration.*failed"

# í•´ê²°: ë§ˆì´ê·¸ë ˆì´ì…˜ ì¬ì‹¤í–‰
docker-compose down -v  # ë³¼ë¥¨ ì‚­ì œ
docker-compose up -d
```

**3. í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ**
```bash
# í™•ì¸
docker-compose exec postgresql psql -U quantiq_user -d quantiq -c "\dt quartz_*"

# í•´ê²°: í…Œì´ë¸” ì—†ìœ¼ë©´ V3 ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸
ls quantiq-core/src/main/resources/db/migration/V3__*.sql
```

### ë¬¸ì œ 2: Jobì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

#### ì¦ìƒ
- ì‹¤í–‰ ì‹œê°„ì´ ë˜ì—ˆëŠ”ë° Jobì´ ì‹¤í–‰ ì•ˆ ë¨
- ë¡œê·¸ì— Job ì‹¤í–‰ ê¸°ë¡ì´ ì—†ìŒ

#### ì§„ë‹¨ ìˆœì„œ

**1. ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸**
```bash
curl http://localhost:8080/api/scheduler/status

# isRunningì´ falseë©´
curl -X POST http://localhost:8080/api/scheduler/start
```

**2. Trigger ìƒíƒœ í™•ì¸**
```sql
SELECT trigger_name, trigger_state
FROM quartz_triggers
WHERE job_name = 'economicDataUpdateJob';

-- PAUSED ìƒíƒœë©´ Resume í•„ìš”
```

```bash
curl -X POST http://localhost:8080/api/scheduler/schedules/economicDataUpdateTrigger/resume
```

**3. ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ í™•ì¸**
```sql
SELECT
    trigger_name,
    to_timestamp(next_fire_time / 1000) AT TIME ZONE 'Asia/Seoul' as next_run
FROM quartz_triggers
WHERE job_name = 'economicDataUpdateJob';

-- next_runì´ ê³¼ê±° ì‹œê°„ì´ë©´ ë¬¸ì œ
```

**4. Cron í‘œí˜„ì‹ ê²€ì¦**
```sql
SELECT cron_expression, time_zone_id
FROM quartz_cron_triggers
WHERE trigger_name = 'economicDataUpdateTrigger';

-- Cron í‘œí˜„ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
-- ì˜¨ë¼ì¸ Cron ê²€ì¦ ë„êµ¬: https://crontab.guru/
```

### ë¬¸ì œ 3: Jobì´ ì¤‘ë³µ ì‹¤í–‰ë¨

#### ì¦ìƒ
- ê°™ì€ Jobì´ ë™ì‹œì— ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰
- ë¡œê·¸ì— ì¤‘ë³µ ì‹¤í–‰ ê¸°ë¡

#### ì›ì¸ ë° í•´ê²°

**1. í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ë½ ì‹¤íŒ¨**
```sql
-- ë½ ìƒíƒœ í™•ì¸
SELECT * FROM quartz_locks;

-- ì˜¤ë˜ëœ ë½ ì œê±° (ìŠ¤ì¼€ì¤„ëŸ¬ ì •ì§€ í›„)
DELETE FROM quartz_locks;
```

**2. NonConcurrent ì„¤ì • ëˆ„ë½**
```kotlin
// Job í´ë˜ìŠ¤ì— ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
@DisallowConcurrentExecution
class EconomicDataUpdateJobAdapter : Job {
    // ...
}
```

**3. ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ê°€ í´ëŸ¬ìŠ¤í„°ë§ ì—†ì´ ì‹¤í–‰**
```yaml
# application.yml í™•ì¸
spring:
  quartz:
    properties:
      org.quartz.jobStore.isClustered: true  # ë°˜ë“œì‹œ true
```

### ë¬¸ì œ 4: Job ì‹¤í–‰ì´ ëŠë¦¼

#### ì¦ìƒ
- Job ì‹¤í–‰ ì‹œê°„ì´ í‰ì†Œë³´ë‹¤ ì˜¤ë˜ ê±¸ë¦¼
- Timeout ì—ëŸ¬ ë°œìƒ

#### ì§„ë‹¨ ë° ìµœì í™”

**1. ì‹¤í–‰ ì‹œê°„ ì¸¡ì •**
```bash
# ë¡œê·¸ì—ì„œ ì‹œì‘-ì™„ë£Œ ì‹œê°„ í™•ì¸
docker-compose logs quantiq-core | grep -A 20 "ê²½ì œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘"
```

**2. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì‘ë‹µ ì‹œê°„ í™•ì¸**
```bash
# Kafka ì—°ê²° ìƒíƒœ
docker-compose exec kafka kafka-broker-api-versions.sh --bootstrap-server kafka:29092

# Data Engine ì‘ë‹µ ì‹œê°„
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:8000/health
```

**3. ì“°ë ˆë“œ í’€ í™•ì¸**
```yaml
# application.yml
spring:
  quartz:
    properties:
      org.quartz.threadPool.threadCount: 10  # ê¸°ë³¸ 10, ëŠ˜ë¦´ ìˆ˜ ìˆìŒ
```

**4. ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥**
```sql
-- í…Œì´ë¸” í†µê³„ ì—…ë°ì´íŠ¸
ANALYZE quartz_triggers;
ANALYZE quartz_job_details;

-- ì¸ë±ìŠ¤ í™•ì¸
\di quartz_*
```

### ë¬¸ì œ 5: ìŠ¤ì¼€ì¤„ëŸ¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜

#### ì¦ìƒ
- ì¥ì‹œê°„ ì‹¤í–‰ í›„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
- OutOfMemoryError ë°œìƒ

#### í•´ê²° ë°©ë²•

**1. ì‹¤í–‰ ì™„ë£Œ ë°ì´í„° ì •ë¦¬**
```sql
-- ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰
DELETE FROM quartz_fired_triggers
WHERE state IN ('COMPLETE', 'ERROR')
  AND fired_time < EXTRACT(EPOCH FROM NOW() - INTERVAL '7 days') * 1000;
```

**2. JVM í™ ë©”ëª¨ë¦¬ ì„¤ì •**
```yaml
# docker-compose.yml
services:
  quantiq-core:
    environment:
      - JAVA_OPTS=-Xms512m -Xmx1024m
```

**3. Job ë‚´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸**
```kotlin
// Jobì—ì„œ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ìŠ¤íŠ¸ë¦¼ ì‚¬ìš©
override fun execute(context: JobExecutionContext?) {
    try {
        // í° ë¦¬ìŠ¤íŠ¸ ëŒ€ì‹  ìŠ¤íŠ¸ë¦¼ ì‚¬ìš©
        items.stream()
            .filter { ... }
            .forEach { ... }
    } finally {
        // ë¦¬ì†ŒìŠ¤ ì •ë¦¬
        cleanup()
    }
}
```

---

## ì„±ëŠ¥ íŠœë‹

### ìŠ¤ì¼€ì¤„ëŸ¬ ìµœì í™”

#### Quartz ì“°ë ˆë“œ í’€ ì¡°ì •

```yaml
spring:
  quartz:
    properties:
      # Job ë™ì‹œ ì‹¤í–‰ ìˆ˜
      org.quartz.threadPool.threadCount: 10  # ê¸°ë³¸ 10

      # ì“°ë ˆë“œ ìš°ì„ ìˆœìœ„
      org.quartz.threadPool.threadPriority: 5

      # í´ë˜ìŠ¤ ë¡œë“œ ì „ëµ
      org.quartz.threadPool.threadNamePrefix: QuantIQ-Scheduler-
```

#### ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€

```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20      # Quartzìš© ì»¤ë„¥ì…˜ í™•ë³´
      minimum-idle: 5
      connection-timeout: 30000
```

### Job ì‹¤í–‰ ìµœì í™”

#### 1. ë¹„ë™ê¸° ì²˜ë¦¬

```kotlin
@Component
class EconomicDataUpdateJobAdapter(
    private val economicDataUseCase: EconomicDataUseCase
) : Job {

    override fun execute(context: JobExecutionContext?) {
        // âœ… ë¹„ë™ê¸° ì²˜ë¦¬ (ë…¼ë¸”ë¡œí‚¹)
        economicDataUseCase.triggerEconomicDataUpdate()
            .thenAccept { result ->
                logger.info("âœ… ì™„ë£Œ: $result")
            }
            .exceptionally { e ->
                logger.error("âŒ ì‹¤íŒ¨", e)
                null
            }
            .get()  // ì™„ë£Œ ëŒ€ê¸°
    }
}
```

#### 2. ë°°ì¹˜ ì²˜ë¦¬

```kotlin
// ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ë¶„í• 
val batchSize = 100
items.chunked(batchSize).forEach { batch ->
    processBatch(batch)
}
```

#### 3. Timeout ì„¤ì •

```kotlin
// Job ì‹¤í–‰ ì‹œê°„ ì œí•œ
@Bean
fun jobTimeout(): Trigger {
    return TriggerBuilder.newTrigger()
        .forJob(economicDataUpdateJobDetail())
        .withSchedule(
            CronScheduleBuilder.cronSchedule("0 5 6 * * ?")
        )
        .usingJobData("timeout", 300000)  // 5ë¶„ íƒ€ì„ì•„ì›ƒ
        .build()
}
```

### ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

#### Slack ì•Œë¦¼ í†µí•© (ì˜ˆì‹œ)

```kotlin
@Component
class SchedulerNotificationService(
    private val slackNotifier: SlackNotificationService
) {

    @EventListener
    fun onJobExecutionFailed(event: JobExecutionFailedEvent) {
        slackNotifier.sendMessage(
            channel = "#quantiq-alerts",
            message = """
                âš ï¸ Job ì‹¤í–‰ ì‹¤íŒ¨
                Job: ${event.jobName}
                ì‹œê°„: ${event.timestamp}
                ì—ëŸ¬: ${event.error}
            """.trimIndent()
        )
    }
}
```

---

## ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. ìŠ¤ì¼€ì¤„ ë³€ê²½ ì‹œ ì£¼ì˜ì‚¬í•­

- **ì„¤ì • ë³€ê²½ í›„ ì¬ì‹œì‘ í•„ìˆ˜**: `QuartzConfig.kt` ë³€ê²½ ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘
- **ìš´ì˜ ì‹œê°„ í”¼í•˜ê¸°**: ìŠ¤ì¼€ì¤„ëŸ¬ ì¬ì‹œì‘ì€ Jobì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ì‹œê°„ì— ìˆ˜í–‰
- **ë°±ì—…**: ë³€ê²½ ì „ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…

```bash
# PostgreSQL ë°±ì—…
docker-compose exec postgresql pg_dump -U quantiq_user quantiq > backup-$(date +%Y%m%d).sql
```

### 2. Job ê°œë°œ ê°€ì´ë“œ

- **ë©±ë“±ì„± ë³´ì¥**: ê°™ì€ Jobì„ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•´ë„ ê²°ê³¼ê°€ ë™ì¼í•´ì•¼ í•¨
- **ì—ëŸ¬ í•¸ë“¤ë§**: ëª¨ë“  ì˜ˆì™¸ë¥¼ catchí•˜ê³  ì ì ˆíˆ ë¡œê¹…
- **ë¦¬ì†ŒìŠ¤ ì •ë¦¬**: Job ì¢…ë£Œ ì‹œ ë°˜ë“œì‹œ ë¦¬ì†ŒìŠ¤ í•´ì œ (DB ì—°ê²°, íŒŒì¼ í•¸ë“¤ ë“±)
- **ì‹¤í–‰ ì‹œê°„ ìµœì†Œí™”**: ì¥ì‹œê°„ ì‹¤í–‰ Jobì€ ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ë³€ê²½

### 3. ëª¨ë‹ˆí„°ë§ ì£¼ê¸°

| í•­ëª© | í™•ì¸ ì£¼ê¸° | ì¡°ì¹˜ ê¸°ì¤€ |
|------|----------|----------|
| ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ | ë§¤ 1ë¶„ | `isRunning: false` ì‹œ ì•Œë¦¼ |
| Job ì‹¤í–‰ ì„±ê³µë¥  | ë§¤ 1ì‹œê°„ | ì„±ê³µë¥  < 95% ì‹œ ì•Œë¦¼ |
| ì‹¤í–‰ ì¤‘ì¸ Job | ë§¤ 5ë¶„ | ì‹¤í–‰ ì‹œê°„ > 10ë¶„ ì‹œ ì•Œë¦¼ |
| ë°ì´í„°ë² ì´ìŠ¤ ìš©ëŸ‰ | ë§¤ì¼ | quartz í…Œì´ë¸” > 1GB ì‹œ ì •ë¦¬ |

### 4. ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ì¼ì¼ ì ê²€
- [ ] ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸ (`/api/scheduler/status`)
- [ ] ì „ë‚  Job ì‹¤í–‰ ì´ë ¥ í™•ì¸
- [ ] ì—ëŸ¬ ë¡œê·¸ í™•ì¸
- [ ] ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ í™•ì¸

#### ì£¼ê°„ ì ê²€
- [ ] Job ì‹¤í–‰ í†µê³„ ë¶„ì„
- [ ] ì„±ëŠ¥ ì§€í‘œ í™•ì¸ (ì‹¤í–‰ ì‹œê°„ ì¶”ì´)
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ìš©ëŸ‰ í™•ì¸
- [ ] ë¡œê·¸ íŒŒì¼ ë°±ì—… ë° ì •ë¦¬

#### ì›”ê°„ ì ê²€
- [ ] Quartz í…Œì´ë¸” ì •ë¦¬ (fired_triggers)
- [ ] ìŠ¤ì¼€ì¤„ ìµœì í™” ê²€í† 
- [ ] ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë¶„ì„
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

## ê´€ë ¨ ë¬¸ì„œ

- [ìŠ¤ì¼€ì¤„ëŸ¬ ì•„í‚¤í…ì²˜](../architecture/SCHEDULER.md)
- [ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ](../architecture/EVENT_DRIVEN_GUIDE.md)
- [ë¡œì»¬ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](./LOCAL_TEST_GUIDE.md)

---

## ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸

```bash
# ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸
curl http://localhost:8080/api/scheduler/status

# ëª¨ë“  ìŠ¤ì¼€ì¤„ ì¡°íšŒ
curl http://localhost:8080/api/scheduler/schedules

# ìŠ¤ì¼€ì¤„ ì¼ì‹œ ì¤‘ì§€
curl -X POST http://localhost:8080/api/scheduler/schedules/{triggerName}/pause

# ìŠ¤ì¼€ì¤„ ì¬ê°œ
curl -X POST http://localhost:8080/api/scheduler/schedules/{triggerName}/resume

# ìŠ¤ì¼€ì¤„ëŸ¬ ë¡œê·¸ í™•ì¸
docker-compose logs -f quantiq-core | grep -E "(Scheduler|Job|ê²½ì œ|ë¶„ì„)"

# ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ í™•ì¸ (PostgreSQL)
docker-compose exec postgresql psql -U quantiq_user -d quantiq -c "
SELECT trigger_name,
       to_timestamp(next_fire_time / 1000) AT TIME ZONE 'Asia/Seoul' as next_run
FROM quartz_triggers ORDER BY next_fire_time;"

# ì‹¤í–‰ ì¤‘ì¸ Job í™•ì¸
docker-compose exec postgresql psql -U quantiq_user -d quantiq -c "
SELECT * FROM quartz_fired_triggers WHERE state = 'EXECUTING';"

# ì—ëŸ¬ ë¡œê·¸ í•„í„°ë§
docker-compose logs quantiq-core --since 24h | grep -i "error.*job\|âŒ"

# ìŠ¤ì¼€ì¤„ëŸ¬ ì¬ì‹œì‘
docker-compose restart quantiq-core
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-31
**ë²„ì „**: 1.0
**ì‘ì„±ì**: QuantIQ Development Team
