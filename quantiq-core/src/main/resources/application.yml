spring:
  application:
    name: quantiq-core

  # ============================================
  # PostgreSQL (RDB) Configuration
  # ============================================
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:quantiq}
    username: ${DB_USER:quantiq_user}
    password: ${DB_PASSWORD:quantiq_password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # ============================================
  # JPA/Hibernate Configuration
  # ============================================
  jpa:
    hibernate:
      ddl-auto: validate  # ⚠️  자동 생성 불가: Flyway로 관리
    generate-ddl: false
    open-in-view: false  # N+1 문제 방지
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          batch_size: 20
          fetch_size: 100
          use_get_generated_keys: true
        format_sql: false

  # ============================================
  # Flyway Configuration
  # ============================================
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    sql-migration-prefix: V
    sql-migration-separator: __

  # ============================================
  # MongoDB Configuration (분석 데이터)
  # ============================================
  data:
    mongodb:
      uri: ${SPRING_DATA_MONGODB_URI:mongodb://localhost:27017/stock_trading}
      auto-index-creation: true

  # ============================================
  # Redis Configuration
  # ============================================
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}

  # ============================================
  # Kafka Configuration
  # ============================================
  kafka:
    bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: quantiq-core
      max-poll-records: 10
    producer:
      acks: all
      retries: 3

  # ============================================
  # Quartz Scheduler Configuration
  # ============================================
  quartz:
    job-store-type: jdbc
    jdbc:
      initialize-schema: never  # Flyway로 관리
    properties:
      org:
        quartz:
          scheduler:
            instanceName: quantiqScheduler
            instanceId: AUTO
          threadPool:
            class: org.quartz.simpl.SimpleThreadPool
            threadCount: 10
            threadPriority: 5
          jobStore:
            class: org.quartz.impl.jdbcjobstore.JobStoreTX
            driverDelegateClass: org.quartz.impl.jdbcjobstore.PostgreSQLDelegate
            tablePrefix: quartz_
            isClustered: false
            useProperties: false
            dataSource: quartzDataSource
          dataSource:
            quartzDataSource:
              driver: org.postgresql.Driver
              URL: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:quantiq}
              user: ${DB_USER:quantiq_user}
              password: ${DB_PASSWORD:quantiq_password}
              maxConnections: 5
              provider: hikaricp

  # ============================================
  # Kafka Configuration (Already set at line 66)
  # ============================================
  # Configuration moved to top-level kafka section for consistency

logging:
  level:
    root: INFO
    com.quantiq: DEBUG
    org.springframework.data.mongodb: DEBUG
    org.hibernate.SQL: DEBUG

# ============================================
# SpringDoc OpenAPI (Swagger) Configuration
# ============================================
springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operationsSorter: method
    tagsSorter: alpha
    display-request-duration: true
    disable-swagger-default-url: true
  show-actuator: false

# ============================================
# Slack Configuration
# ============================================
slack:
  webhook-url: ${SLACK_WEBHOOK_URL:}
  bot-token: ${SLACK_BOT_TOKEN:}
  channel: ${SLACK_CHANNEL:#trading-alerts}

# ============================================
# KIS Configuration (Korean Investment & Securities)
# ============================================
kis:
  app-key: ${KIS_APP_KEY:test_app_key}
  app-secret: ${KIS_APP_SECRET:test_app_secret}
  base-url: https://openapivts.koreainvestment.com:29443
  account-no: ${KIS_ACCOUNT_NO:00000000000}

# ============================================
# Custom Properties
# ============================================
db:
  rdb:
    enabled: true
  dual-write: ${DB_DUAL_WRITE:true}       # 마이그레이션 기간 MongoDB도 업데이트
  read-source: ${DB_READ_SOURCE:rdb}      # rdb, mongo, both
  migration:
    enabled: ${RUN_MIGRATION:false}
